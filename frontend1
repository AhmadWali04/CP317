<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Random Restaurant Picker</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .section { margin-bottom: 25px; }
    input, select, button { margin: 5px 0; padding: 8px; width: 100%; }
    #results { margin-top: 20px; }
    .restaurant-card { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
  </style>
</head>
<body>

  <h1>üçΩÔ∏è Random Restaurant Picker</h1>

  <!-- Location Section -->
  <div class="section">
    <h3>1. Get Your Location</h3>
    <button onclick="getLocation()">üìç Scan Location</button>
    <div id="locationStatus">Waiting for location...</div>
  </div>

  <!-- Preferences Section -->
  <div class="section">
    <h3>2. Set Your Preferences</h3>
    <label>Price Range ($ to $$$$):</label>
    <select id="price">
      <option value="">Any</option>
      <option value="$">$</option>
      <option value="$$">$$</option>
      <option value="$$$">$$$</option>
      <option value="$$$$">$$$$</option>
    </select>

    <label>Radius (km):</label>
    <input type="number" id="radius" placeholder="e.g., 5"/>

    <label>Preferred Cuisine (comma separated):</label>
    <input type="text" id="cuisine" placeholder="e.g., Italian, Chinese"/>

    <button onclick="submitPreferences()">üîç Search Restaurants</button>
  </div>

  <!-- Results Section -->
  <div id="results" class="section">
    <h3>3. Results</h3>
    <div id="restaurantList"></div>
  </div>

  <script>
    let userLocation = null;

    function getLocation() {
      const output = document.getElementById("locationStatus");
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(position => {
          userLocation = {
            latitude: position.coords.latitude,
            longitude: position.coords.longitude
          };
          output.innerHTML = `‚úÖ Latitude: ${userLocation.latitude}, Longitude: ${userLocation.longitude}`;

          // Send to backend servlet
          fetch('http://localhost:8080/restaurantProject/LocalServer', {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(userLocation)
          })
          .then(res => res.text())
          .then(data => console.log("Backend response:", data))
          .catch(err => console.error("Error sending location:", err));
        });
      } else {
        output.innerHTML = "‚ùå Geolocation is not supported by this browser.";
      }
    }

    function submitPreferences() {
      if (!userLocation) {
        alert("Please scan your location first!");
        return;
      }

      const price = document.getElementById("price").value;
      const radius = document.getElementById("radius").value;
      const cuisine = document.getElementById("cuisine").value.split(',').map(c => c.trim());

      const preferences = {
        location: userLocation,
        priceRange: price,
        radius: parseFloat(radius),
        cuisine: cuisine
      };

      fetch("http://localhost:8080/restaurantProject/searchRestaurants", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(preferences)
      })
      .then(res => res.json())
      .then(data => displayRestaurants(data))
      .catch(err => console.error("Search error:", err));
    }

    function displayRestaurants(data) {
      const container = document.getElementById("restaurantList");
      container.innerHTML = "";

      if (!data || data.length === 0) {
        container.innerHTML = "<p>No restaurants found matching your preferences.</p>";
        return;
      }

      data.forEach(r => {
        const card = document.createElement("div");
        card.className = "restaurant-card";
        card.innerHTML = `<strong>${r.name}</strong><br/>
                          Cuisine: ${r.cuisine || "N/A"}<br/>
                          Price: ${r.price || "N/A"}<br/>
                          Location: ${r.location || "N/A"}`;
        container.appendChild(card);
      });
    }
  </script>
</body>
</html>
